# 端口可视化管理功能说明

## 功能概述

全新的端口可视化管理界面，支持精确到毫米的物理布局，可以用图片或 SVG 直观展示服务器背板的真实样子。

## 🆕 新特性（v2.0）

- ✅ **智能端口排序**：自动识别端口号的数字部分，避免 "5" > "47" 的排序问题
- ✅ **端口组模板**：预置 9 种常见网络设备模板，一键快速创建
- ✅ **智能编号**：支持多种编号模式（Cisco、华为、HP等）
- ✅ **标准尺寸**：默认使用标准 1U 尺寸（482.6mm × 44.45mm）
- ✅ **自动布局**：模板自动计算端口位置，无需手动设置

## 主要特性

### 1. 精确物理布局
- **面板尺寸**：支持精确到 mm 的宽度和高度设置
- **面板位置**：支持 X/Y 坐标定位（单位：mm）
- **端口位置**：每个端口相对于面板的精确坐标（单位：mm）
- **端口尺寸**：支持设置每个端口的宽度和高度

### 2. 视觉展示
- **背景颜色**：可自定义面板背景色
- **图片支持**：可上传面板实物照片作为背景
- **SVG 支持**：支持矢量图形，适合绘制标准化面板

### 3. 交互设计
- **两层结构**：先选择设备和面板，再查看端口
- **直观展示**：SVG 渲染，精确还原物理位置关系
- **悬浮提示**：鼠标悬停显示端口详细信息
- **点击编辑**：直接点击端口即可编辑

## 数据结构

### Panel（面板）

```typescript
{
  id: string;
  name: string;
  type: PanelType;  // ETHERNET, FIBER, POWER, SERIAL, USB, OTHER
  deviceId: string;

  // 物理布局（单位：mm）
  position?: {
    x: number;
    y: number;
  };
  size?: {
    width: number;
    height: number;
  };

  // 视觉样式
  backgroundColor?: string;  // 例如：'#f5f5f5'
  image?: string;            // 图片 URL
  svgPath?: string;          // SVG 路径
}
```

### Port（端口）

```typescript
{
  id: string;
  number: string;
  label?: string;
  status: PortStatus;  // AVAILABLE, OCCUPIED, RESERVED, FAULTY
  panelId: string;

  // 物理布局（相对于面板，单位：mm）
  position?: {
    x: number;
    y: number;
  };
  size?: {
    width: number;
    height: number;
  };

  // 扩展字段
  ipAddress?: string;
  vlan?: string;
  speed?: string;
}
```

## 预置端口组模板

系统预置了 9 种常见网络设备的端口组模板：

| 模板名称 | 端口数量 | 端口类型 | 布局 | 适用设备 |
|---------|---------|---------|------|---------|
| 8口千兆交换机 | 8 | RJ45 | 1×8 | 小型接入交换机 |
| 24口千兆交换机 | 24 | RJ45 | 2×12 | 标准接入交换机 |
| 48口千兆交换机 | 48 | RJ45 | 2×24 | 核心接入交换机 |
| 12口SFP光口 | 12 | SFP | 1×12 | 光纤接入模块 |
| 24口SFP+光口 | 24 | SFP+ | 2×12 | 万兆光纤交换机 |
| 32口QSFP28 | 32 | QSFP28 | 2×16 | 100G核心交换机 |
| Cisco 48+4 | 48 | RJ45 | 2×24 | Cisco风格交换机 |
| 华为24口 | 24 | RJ45 | 2×12 | 华为交换机 |
| 服务器4口网卡 | 4 | RJ45 | 1×4 | 服务器网卡 |

### 支持的编号模式

| 编号模式 | 示例 | 说明 |
|---------|------|------|
| SIMPLE | 1, 2, 3... | 简单数字编号 |
| WITH_PREFIX | Port-1, Port-2... | 带前缀编号 |
| CISCO_ETHERNET | GigabitEthernet0/0/1 | Cisco完整格式 |
| CISCO_SHORT | Gi0/0/1 | Cisco简短格式 |
| HUAWEI | GE1/0/1 | 华为格式 |
| HP | 1/1/1 | HP格式 |

## 使用步骤

### 方式一：使用端口组模板（推荐）

1. 进入"连接管理" → "端口可视化"
2. 从左侧选择设备和面板
3. 点击"**应用模板**"按钮
4. 选择合适的端口组模板
5. 配置编号参数（可选）：
   - **Slot**：插槽号（默认 1）
   - **Module**：模块号（默认 0）
   - **Card**：卡号（默认 0）
   - **起始编号**：从几号开始（默认 0）
6. 点击确定，系统自动：
   - 创建所有端口
   - 设置端口物理位置
   - 配置面板尺寸
   - 应用正确的编号格式

### 方式二：手动配置

#### 1. 配置面板物理布局

1. 进入"连接管理" → "端口可视化"
2. 从左侧选择设备和面板
3. 点击"面板配置"按钮
4. 设置：
   - **尺寸**：宽度和高度（mm）
   - **位置**：X/Y 坐标（通常设为 0, 0）
   - **背景色**：例如 `#e8e8e8`
   - **图片/SVG**：可选，用于更真实的展示

### 2. 创建和配置端口

#### 单个创建
1. 点击"新建端口"
2. 填写端口信息：
   - 端口号：例如 `1`, `2`, `3`...
   - 标签：例如 `eth0-1`
   - 状态：可用/已占用/预留/故障
3. 设置物理布局（可选）：
   - X/Y 坐标：端口在面板上的位置
   - 宽度/高度：端口的尺寸

#### 批量创建
1. 点击"批量创建"
2. 设置：
   - 端口数量：1-128
   - 标签前缀：例如 `Port-`
3. 系统自动创建编号为 1 到 N 的端口

### 3. 编辑端口位置

有两种方式编辑端口：
1. **点击端口**：在可视化面板上直接点击端口
2. **列表编辑**：在下方端口列表中点击编辑按钮

### 4. 管理端口状态

- **在可视化图中**：端口用不同颜色标识状态
  - 🟢 绿色 - 可用
  - 🔴 红色 - 已占用
  - 🟡 黄色 - 预留
  - ⚫ 灰色 - 故障
- **在列表中**：可直接切换端口状态

## 快速开始示例

### 示例 1：Cisco 48口交换机（使用模板）

**需求**：配置一台 Cisco Catalyst 2960X 48口交换机

**步骤**：
1. 创建设备和面板（面板名称：FastEthernet）
2. 点击"应用模板" → 选择"Cisco 48+4 交换机"
3. 设置编号参数：
   - Card: 0
   - Module: 0
   - Slot: 1
4. 点击确定

**结果**：
- 自动创建 48 个端口
- 端口号：GigabitEthernet0/0/1 到 GigabitEthernet0/0/48
- 自动布局：双行 24 列
- 面板尺寸：标准 1U

### 示例 2：华为交换机（手动编号）

**需求**：华为 S5720 交换机，端口编号从 GE1/0/1 开始

**步骤**：
1. 选择"华为24口"模板
2. 设置：Slot=1, Module=0
3. 自动生成：GE1/0/1, GE1/0/2... GE1/0/24

### 示例 3：服务器多网卡

**需求**：Dell R740 服务器，4 个板载网口 + 双口万兆网卡

**步骤**：
1. 创建两个面板：
   - 面板1：板载网口（应用"服务器4口网卡"模板）
   - 面板2：万兆网卡（手动创建 2 个端口）
2. 分别设置位置，错开排列
3. 端口编号可自定义：eth0, eth1, eth2, eth3, 10ge0, 10ge1

## 典型场景示例（进阶）

### 场景 1：完全自定义 48 口交换机背板

```typescript
// 面板配置
{
  name: "eth0",
  type: "ETHERNET",
  size: { width: 480, height: 44 },  // 标准 1U 交换机
  backgroundColor: "#2c3e50"
}

// 端口配置（6列8行布局）
// 第一行第一个端口
{
  number: "1",
  label: "Port-1",
  position: { x: 10, y: 10 },
  size: { width: 15, height: 12 }
}

// 第一行第二个端口
{
  number: "2",
  label: "Port-2",
  position: { x: 90, y: 10 },
  size: { width: 15, height: 12 }
}
// ... 以此类推
```

### 场景 2：服务器后面板（多种接口）

可以为同一设备创建多个面板：
- 网口面板（ETHERNET）
- 管理口面板（SERIAL）
- 电源接口面板（POWER）

每个面板独立配置位置和端口布局。

## 最佳实践

### 1. 尺寸规划
- 建议使用真实物理尺寸（mm）
- 可以用尺子测量实际设备
- 或参考设备规格书

### 2. 端口布局
- 先批量创建端口
- 再逐个设置位置
- 保持统一的间距

### 3. 视觉优化
- 使用对比明显的背景色
- 上传高清图片（如果使用图片）
- SVG 适合标准化设备

### 4. 命名规范
- 端口号使用数字：1, 2, 3...
- 标签使用描述性名称：eth0-1, mgmt-1
- 面板名称使用接口类型：eth0, fiber0

## 技术细节

### 前端实现
- **框架**：React + TypeScript
- **UI 库**：Ant Design
- **渲染**：SVG（支持精确坐标和缩放）
- **组件**：`PanelVisualizer` 可视化组件

### 后端实现
- **数据库**：PostgreSQL
- **ORM**：Prisma
- **坐标存储**：Float 类型（mm 单位）

### 数据库字段
```sql
-- Panel 表
positionX       FLOAT
positionY       FLOAT
width           FLOAT
height          FLOAT
backgroundColor VARCHAR
image           VARCHAR
svgPath         VARCHAR

-- Port 表
positionX       FLOAT
positionY       FLOAT
width           FLOAT
height          FLOAT
```

## 常见问题

### Q: 如何获取精确的物理尺寸？
A: 可以：
1. 查阅设备规格书
2. 用尺子测量实物
3. 参考标准尺寸（如 1U = 44.45mm）

### Q: 端口位置坐标怎么确定？
A: 建议：
1. 先拍照或截图
2. 用图像软件标注坐标
3. 输入到系统中
4. 在可视化界面中调整

### Q: 可以导入已有的配置吗？
A: 目前需要手动配置，未来版本会支持：
- 批量导入 CSV
- 模板复用
- 智能布局生成

### Q: 支持哪些图片格式？
A: 支持所有常见格式：
- PNG（推荐，支持透明）
- JPG
- SVG（矢量图，最佳）

## 未来规划

- [ ] 拖拽式端口布局编辑器
- [ ] 端口模板库（常见设备）
- [ ] 批量导入/导出
- [ ] 3D 视图支持
- [ ] 自动布局算法
- [ ] 线缆连接可视化

## 访问路径

- 菜单：连接管理 → 端口可视化
- URL：`/ports/visual`

---

> 如有问题或建议，请联系开发团队！
