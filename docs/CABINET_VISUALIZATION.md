# 机柜可视化管理功能说明

## 功能概述

全新的机柜可视化功能，采用 2.5D 等距视图展示机柜的立体效果，直观呈现设备在机柜中的U位分布和占用情况。

## 🎨 核心特性

### 1. 2.5D 立体视图
- **等距投影**：30°倾斜角度，呈现立体机柜效果
- **标准机架**：19英寸标准机架，支持1-52U高度
- **U位标尺**：左侧显示U位编号，从上到下递减
- **立体框架**：包含前面板、侧面板和顶板的立体渲染

### 2. 智能U位管理
- **占用检测**：自动检测U位占用状态
- **设备布局**：根据设备的起始U位和高度自动渲染
- **冲突检测**：防止设备位置重叠
- **空位提示**：虚线框显示可用U位

### 3. 实时统计信息
- **设备数量**：显示机柜中的设备总数
- **U位占用**：已用U数/总U数
- **利用率**：机柜空间利用率百分比
- **颜色标识**：根据利用率显示不同颜色（绿色<60%，橙色60-80%，红色>80%）

### 4. 交互功能
- **设备选择**：点击机柜查看详细设备列表
- **悬浮提示**：鼠标悬停显示设备详细信息
- **快速操作**：直接添加、编辑、删除设备
- **分层浏览**：按机房/数据中心层级浏览

## 数据结构

### Cabinet（机柜）

```typescript
interface Cabinet {
  id: string;
  name: string;        // 机柜名称，如：A-01, B-15
  position?: string;   // 位置描述，如：第一排第三列
  height: number;      // U位高度，通常为42U
  roomId: string;      // 所属机房ID
  createdAt: string;
  updatedAt: string;
}
```

### Device（设备）

```typescript
interface Device {
  id: string;
  name: string;           // 设备名称，如：WEB-Server-01
  type: DeviceType;       // 设备类型
  model?: string;         // 型号，如：Dell PowerEdge R740
  serialNo?: string;      // 序列号
  uPosition?: number;     // 起始U位（从上往下，1开始）
  uHeight?: number;       // 占用U数（通常1-3U）
  cabinetId: string;      // 所属机柜ID
  // 扩展字段
  ipAddresses?: string[];
  managementIp?: string;
  powerPhase?: string;
  powerSource?: 'MAINS' | 'UPS';
  snmpEnabled?: boolean;
  ipmiEnabled?: boolean;
  createdAt: string;
  updatedAt: string;
}
```

### 设备类型配置

```typescript
enum DeviceType {
  SERVER = 'SERVER',      // 服务器 - 默认2U
  SWITCH = 'SWITCH',      // 交换机 - 默认1U
  ROUTER = 'ROUTER',      // 路由器 - 默认1U
  FIREWALL = 'FIREWALL',  // 防火墙 - 默认1U
  STORAGE = 'STORAGE',    // 存储设备 - 默认2U
  PDU = 'PDU',            // 电源分配单元 - 默认1U
  OTHER = 'OTHER',        // 其他设备 - 默认1U
}
```

## 使用指南

### 1. 创建机柜

1. 进入"基础设施" → "机柜可视化"
2. 点击左侧"新建机柜"按钮
3. 填写机柜信息：
   - **机柜名称**：建议使用命名规范（A-01, B-15）
   - **位置**：机房中的物理位置描述
   - **U数**：机柜高度（标准42U）
   - **所属机房**：选择对应的机房
4. 点击确定创建

### 2. 添加设备

#### 方式一：从机柜视图中添加
1. 在左侧列表中选择机柜
2. 点击右侧"添加设备"按钮
3. 填写设备信息：
   - **设备名称**：建议使用规范命名
   - **设备类型**：选择对应的设备类型
   - **型号**：设备的具体型号
   - **序列号**：设备的SN号
   - **起始U位**：设备在机柜中的起始位置
   - **占用U数**：设备占用的U位高度
4. 点击确定，设备会自动添加到机柜视图中

#### 方式二：从机柜列表中添加
1. 在左侧机柜列表中找到目标机柜
2. 点击机柜卡片中的"添加设备"按钮
3. 系统会自动选中该机柜
4. 填写设备信息并保存

### 3. U位规划

#### 标准2U服务器部署
```
U位置: 38-39
配置: uPosition=38, uHeight=2
说明: 占用U38和U39两个U位
```

#### 1U交换机部署
```
U位置: 42
配置: uPosition=42, uHeight=1
说明: 只占用U42一个U位（通常在网络区域）
```

#### 多设备布局示例
```
机柜: 42U标准机柜
设备布局:
- PDU: U1 (1U)
- 网络交换机: U42-U44 (3U)
- 核心交换机: U39-U41 (3U)
- 服务器1: U1-U2 (2U)
- 服务器2: U3-U4 (2U)
- 存储阵列: U10-U15 (6U)
```

### 4. 查看和管理

#### 查看机柜状态
- **颜色标识**：根据利用率显示不同颜色
  - 🟢 绿色：利用率 < 60%（空闲）
  - 🟡 橙色：利用率 60-80%（正常）
  - 🔴 红色：利用率 > 80%（拥挤）

- **统计信息**：每个机柜显示：
  - 设备数量
  - 已用U数/总U数
  - 可用U数
  - 利用率百分比

#### 设备管理
1. **查看详情**：点击设备查看详细信息
2. **编辑设备**：点击编辑按钮修改设备信息
3. **删除设备**：点击删除按钮移除设备
4. **移动设备**：编辑设备的U位位置

## 可视化效果说明

### 2.5D 立体渲染

机柜采用等距投影技术呈现立体效果：

```
侧视图角度：30°
渲染层级：
1. 背景层 - 渐变背景
2. 机柜框架 - 立体金属框架
3. 设备层 - 2.5D设备模型
4. 前景层 - U位标尺和标注
```

### 设备渲染效果

每种设备类型都有独特的颜色和图标：

- **服务器（蓝色）**：通常2U，显示服务器图标
- **交换机（绿色）**：通常1U，显示网络图标
- **路由器（橙色）**：通常1U，显示路由图标
- **防火墙（红色）**：通常1U，显示盾牌图标
- **存储（紫色）**：通常2U，显示存储图标
- **PDU（青色）**：通常1U，显示电源图标

### U位状态显示

- **已占用U位**：设备占用的U位显示为实色
- **空闲U位**：虚线框表示可用位置
- **悬浮效果**：鼠标悬停时高亮显示
- **点击交互**：点击设备查看详细信息

## 最佳实践

### 1. 机柜命名规范

建议采用统一的命名规范：
- **字母-数字格式**：A-01, B-15
- **字母含义**：A=第一排，B=第二排
- **数字含义**：01-99表示列号
- **示例**：
  - A-01：第一排第1列
  - B-15：第二排第15列

### 2. U位规划策略

#### 标准机柜布局（自上而下）
```
U42-U44: 网络设备区域
U39-U41: 上行交换机
U37-U38: 管理设备
U1-U36: 服务器和存储区域
```

#### 功率和散热考虑
- **高功率设备**：放在机柜上部（散热更好）
- **网络设备**：放在顶部（便于线缆管理）
- **服务器集群**：集中放置便于管理
- **电源设备**：放在底部（稳定供电）

### 3. 设备命名规范

建议使用描述性命名：
- **WEB-Server-01**：Web服务器1号
- **DB-Master-01**：数据库主服务器
- **SW-Core-01**：核心交换机1号
- **FW-Edge-01**：边界防火墙

### 4. 空间优化建议

1. **提高利用率**：目标利用率控制在70-80%
2. **预留空间**：预留10-15%空间用于扩展
3. **合理分配**：不同设备类型合理分布
4. **定期整理**：定期清理闲置设备

## 常见问题

### Q1: 设备可以重叠放置吗？

**A**: 不可以。系统会自动检测U位冲突，不允许设备重叠。如果设置的U位已被占用，会提示错误。

### Q2: 如何移动设备到其他U位？

**A**:
1. 点击设备进入编辑模式
2. 修改"起始U位"为新的位置
3. 确保新的位置有足够的空间
4. 保存更改

### Q3: 机柜可以修改高度吗？

**A**: 可以，但需要注意：
- 如果减小高度，可能导致设备超出机柜范围
- 增加高度不会影响现有设备布局
- 建议在创建设备前确定合适的机柜高度

### Q4: 支持哪些设备类型？

**A**: 系统预置了7种设备类型：
- SERVER（服务器）- 默认2U
- SWITCH（交换机）- 默认1U
- ROUTER（路由器）- 默认1U
- FIREWALL（防火墙）- 默认1U
- STORAGE（存储）- 默认2U
- PDU（电源分配）- 默认1U
- OTHER（其他）- 默认1U

### Q5: 如何查看机柜的详细信息？

**A**:
1. 选择机柜后，右侧会显示2.5D视图
2. 左侧机柜卡片显示统计信息
3. 下方列表显示所有设备详情
4. 点击设备查看更多信息

### Q6: 支持导入导出吗？

**A**: 当前版本暂不支持，未来版本将添加：
- Excel批量导入设备
- 机柜布局导出
- 配置模板功能

## 技术实现细节

### 渲染技术

- **SVG渲染**：使用SVG实现精确的图形渲染
- **等距投影**：30°角度的立体投影算法
- **响应式设计**：支持不同屏幕尺寸自适应
- **性能优化**：虚拟化渲染大量设备

### 数据算法

- **U位计算**：基于起始位置和高度的占用计算
- **冲突检测**：防止设备重叠的算法
- **利用率统计**：实时计算空间利用率
- **排序算法**：设备按U位自动排序

### 交互设计

- **悬浮提示**：显示详细设备信息
- **点击反馈**：视觉和交互反馈
- **状态管理**：实时数据同步
- **错误处理**：友好的错误提示

## 未来规划

- [ ] 3D视图支持
- [ ] 设备拖拽编辑
- [ ] 线缆连接可视化
- [ ] 功率和散热模拟
- [ ] 自动化布局建议
- [ ] 设备模板系统
- [ ] 批量导入导出
- [ ] 移动端支持

## 相关功能

- [端口可视化管理](./PORT_VISUALIZATION.md)
- [线缆拓扑管理](./CABLE_TOPOLOGY.md)
- [设备管理系统](./DEVICE_MANAGEMENT.md)

---

> 如有问题或建议，请联系开发团队！
